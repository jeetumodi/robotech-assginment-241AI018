FROM node:20-alpine

WORKDIR /app/frontend

# Copy frontend only
COPY frontend/ .

# CI-safe install
RUN npm ci

# Build-time env
ARG VITE_API_BASE_URL=http://localhost:8000
ENV VITE_API_BASE_URL=${VITE_API_BASE_URL}

RUN echo "VITE_API_BASE_URL=${VITE_API_BASE_URL}" > .env

# Production build
RUN npm run build

# Artifact check
RUN test -d dist

CMD ["echo", "âœ… Frontend CI build successful"]
